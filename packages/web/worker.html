<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <style>
            canvas {
                width: 100px;
                height: 100px;
                margin: 10px;
            }
        </style>
    </head>
    <body>
        <h1>dotLottie Worker</h1>
        <div></div>
        <script type="module">
            import { DotLottieWorker as DotLottie } from './dist/worker/index.js';

            DotLottie.setWasmUrl('http://127.0.0.1:5500/packages/web/dist/dotlottie-player.wasm');

            const allCanvas = new Array(50).fill().map(() => {
                const canvas = document.createElement('canvas');
                canvas.setAttribute(
                    'data-src',
                    'https://lottie.host/647eb023-6040-4b60-a275-e2546994dd7f/zDCfp5lhLe.json',
                );

                document.body.appendChild(canvas);

                return canvas;
            });

            for (let i = 0; i < allCanvas.length; ++i) {
                const canvas = allCanvas[i];

                const dotLottie = new DotLottie({
                    canvas,
                    src: canvas.getAttribute('data-src'),
                    autoplay: true,
                    loop: true,
                });

                const events = [
                    'play',
                    'pause',
                    'stop',
                    'render',
                    'destroy',
                    'frame',
                    'freeze',
                    'unfreeze',
                    'destroy',
                    'load',
                    'loadError',
                ];

                events.forEach((event) => {
                    dotLottie.addEventListener(event, (evt) => {
                        console.log(i, evt);
                    });
                });
            }
        </script>
        <script>
            var script = document.createElement('script');
            script.onload = function () {
                var stats = new Stats();
                document.body.appendChild(stats.dom);
                requestAnimationFrame(function loop() {
                    stats.update();
                    requestAnimationFrame(loop);
                });
            };
            script.src = 'https://mrdoob.github.io/stats.js/build/stats.min.js';
            document.head.appendChild(script);
        </script>
    </body>
</html>
